---
title: "Data Exploration"
output: html_notebook
---

# Overview
This document will be used for the data exploration phase of this project.  The first thing that I am going to do is upload the usual code to set up the workspace.

```{r}
# clear R's environment
rm(list = ls())

# upload the libraries that we will need for this analysis
library(ggplot2)
library(dplyr)
library(here)
library(ggfortify)
```
Now I will pull in the dataset that I selected for the capstone project.  The data set consists of different gait analysis metrics for individuals walking up and down a sloped surface with a prosthetic containing a microcontroller and one that does not. 

```{r}
# import data set using read.csv() and stringsAsFactors = TRUE to import the categorical data as factors with levels that we can look at
DF <- read.csv(here("Data", "Raw", "prosthetic_analysis.csv"), stringsAsFactors = TRUE)

# take an initial look at the structure of the data set
glimpse(DF)
```

you moved your data into the Raw folder so the read.csv call doesn't work. Make sure to fix that.

```{r}
DF <- read.csv(here("Data", "Raw","prosthetic_analysis.csv"), stringsAsFactors = TRUE)

# take an initial look at the structure of the data set
glimpse(DF)
```


# Data Exploration
Now, the three things that I want to analyse within this data set are: 
1. The propulsion of the different types of prosthetic while walking uphill compared to the intact leg.
2. The dampening power of the different types of prostheses compared to the intact leg. 
3. The relationship between stance and overall swing velocity.

After looking at the data initially, there is a lot of information inside of it.  The first thing that we are going to do is simplify things by taking out the data we want and placing it into a new data frame.

Good idea!

```{r}
# select the data that we want from the current data set
DF_refined <- DF %>% select(c("Subject", "Session", "Side", "Slope","Power.Gen...Preswing", "Power.Gen...Midstance", "Power.Gen...Terminal.stance", "Propulsion", "Braking", "Velocity" ))
```
Now that I have the data that I want to take a look at separated from the rest of the data, I will clean it up a bit to make it easier to understand starting with modifying the column titles. 
```{r}
# clean up the column headers
names(DF_refined) <- c("Subject", "Session", "Side", "Slope", "Power_Gen_Pre", "Power_Gen_Mid", "Power_Gen_Terminal", "Propulsion", "Braking", "Velocity")
```
Next we want to remove the data for the subjects starting with "C". The author specifies that these trials were from subjects that were used to test and calibrate the system. Because they do not have the type of prosthetic specified and the data is from calibration, we will take this out so it does not skew the analysis. 
```{r}
# remove the calibration data
DF_refined <- DF_refined %>%
  filter(Side == "Prosthetic" | Side == "Intact")
```


The data has been cleaned up a bit now which makes it a little easier to understand.  During the data analysis phase, we want to get a sense of the central tendency and the spread of the data.  I will first get a sense of central tendency by looking at the data using the `summary()` function.  This will give us a summary of the basic statistics for the data we are interested in.  This will also give us the chance to look for any potential outliers in the data. 

```{r}
# run a summary of the data to draw some basic stats and look for outliers
summary(DF_refined)
```
### Power Generation in Terminal Phase
From this, the only potential outlier that I see is in the Power_Gen_Terminal column.  The mean of the power generated in this position is 0.8266 and the maximum is 2.71 watts.  This is a pretty big difference so lets take a closer look with a histogram:

```{r}
# make a histogram of the Power_Gen_Terminal
ggplot(DF_refined, aes(x = Power_Gen_Terminal))+
    geom_histogram(binwidth = 1)+
    facet_wrap(~Side)
```
Since I am interested in looking at the differences between the power generated by the intact side and the prosthetic side, I split them by condition.  This shows us that the potential outlier in power generation happened with the intact leg.  I will keep this data in the mix because it was collected by a variety of biosensors that reported values directly to a computer software program designed to map the moments.  Additionally data like this could be explained by an individual's eagerness to participate in the study.  Let's take a closer look to see what the differences are between the BiOM prosthetic and the ESR prosthetic.

```{r}
# make a histogram of the Power_Gen_Terminal based on prosthetic type
ggplot(filter(DF_refined, Side == "Prosthetic"), aes(x = Power_Gen_Terminal))+
    geom_histogram(binwidth = 0.5)+
    facet_wrap(~Session)
```
### Power Generation in Preswing
Now let's take a look at the power generation in the other stance phases:
```{r}
# make a histogram of the Power_Gen_Pres
ggplot(DF_refined, aes(x = Power_Gen_Pre))+
    geom_histogram(binwidth = 1)+
    facet_wrap(~Side)
```
This is interesting because it looks like there is a little bit of an outlier in the prosthetic data.  Let's compare the two different types of prosthetics:
```{r}
# make a histogram of the Power_Gen_Pre based on prosthetic type
ggplot(filter(DF_refined, Side == "Prosthetic"), aes(x = Power_Gen_Pre))+
    geom_histogram(binwidth = 0.5)+
    facet_wrap(~Session)
```
Now we know that the differences in power generation came from the active BiOM prosthetic which is interesting because in that prosthetic, there is a micro controller that is determining the power output.

### Power Generation in Midswing
Let's take a look at the spread of the power generation in the midswing phase.  
```{r}
# make a histogram of the Power_Gen_Mid
ggplot(DF_refined, aes(x = Power_Gen_Mid))+
    geom_histogram(binwidth = 0.5)+
    facet_wrap(~Side)
```
This is interesting because the power generation in the mid swing is distributed over the same range for both the intact and the prosthetic, but there is a clear gap in the prosthetic data.  I'll take a closer look at this by graphing the prosthetic data alone. 
```{r}
# make a histogram of the Power_Gen_Mid based on prosthetic type
ggplot(filter(DF_refined, Side == "Prosthetic"), aes(x = Power_Gen_Mid))+
    geom_histogram(binwidth = 0.5)+
    facet_wrap(~Session)
```
Closer analysis shows that for both the active and passive prostheses, the distribution looks pretty similar except for the data at -1.5 watts that corresponds to the active prosthetic.  This could be an outlier, but since it is still within the range of the intact leg, I think I will keep it. 

### Propulsion
Now that we have taken a look at the data for power generation during the different phases of walking, let's look at the other things that we are interested in starting with propulsion. We will use a histogram again to look at the spread of the propulsion data between the intact and prosthetic legs. 

```{r}
# use histogram to look at the propulsion data
ggplot(DF_refined, aes(x = Propulsion))+
    geom_histogram(binwidth = 0.5)+
    facet_wrap(~Side)
```
upon initial analysis, these look pretty similar.  Lets take a look at the differences between the two types of prosthetics.

```{r}
# make a histogram of the propulsion based on prosthetic type
ggplot(filter(DF_refined, Side == "Prosthetic"), aes(x = Propulsion))+
    geom_histogram(binwidth = 0.5)+
    facet_wrap(~Session)
```
Again, not a huge difference between the two.  If anything there might be a little bit more propulsion in the active prosthetic but further analysis is needed to determine if this is significant.

### Braking
Now let's explore the braking data.
```{r}
# use a histogram to look at the spread of the braking data
ggplot(DF_refined, aes(x = Braking))+
    geom_histogram(binwidth = 0.5)+
    facet_wrap(~Side)
```
These look very similar and the spread is almost identical between the two - let's see if this trend holds between the two different prosthetics:
```{r}
# make a histogram of the braking based on prosthetic type
ggplot(filter(DF_refined, Side == "Prosthetic"), aes(x = Braking))+
    geom_histogram(binwidth = 0.5)+
    facet_wrap(~Session)
```
This gives us some more insight into how the micro controller inside of the BiOM prosthetic may work to reduce the overall stresses on the body. Again however, more analysis is needed before we see if there is a significant impact here. 

### Velocity
The last thing that I want to look at is velocity.  If the user is swinging the prosthetic too fast and spending more time on their intact leg, it could indicate that they are compensating more which would increase the extra stress and strain on their body. Step velocity is a good way to measure this because it tells us whether there is a side that they prefer. To take a look at this, we will go through the same process as before but instead create a boxplot of the data: 

```{r}
# use a boxplot to look at the spread of the velocity data
ggplot(DF_refined, aes(x = Side, y = Velocity)) +
geom_boxplot()+
  geom_point(size = 3, colour = 'lightgrey', alpha = 0.5)
  
  
```
This is interesting, the spread of the data looks pretty much identical.  Also, according to these plots it looks like there may be an outlier at the same spot for both.  I feel like this is too much of a coincidence to be an outlier so we will keep that point in.  

Ok - I looked more closely, and these data ARE identical. I can't picture that happening by chance. Is there a chance that the velocity was somehow set by the researchers? Or is velocity a variable that is measured for the trial and is assigned the same value for both legs (i.e. the person is moving at a particular velocity, which means both legs are moving at the same velocity, in which case they should be the same for the intact and prosthetic leg...)




Now let's investigate whether there is a difference between the prosthesis types:

```{r}
# make a histogram of the velocity based on prosthetic type
ggplot(filter(DF_refined, Side == "Prosthetic"), aes(x = Velocity))+
    geom_histogram(binwidth = 0.5)+
    facet_wrap(~Session)
```
From the first initial glance it does look like there may be a difference here. That being said, it is difficult to determine if this is big enough to be significant because the ranges are still pretty close.  

## Data Exploration Conclusion
From this process we were able to look a little closer at the spread and the central tendencies of the data.  It also helped us take a look at different potential outliers and determine whether to keep them in the dataset or not.  Right now it appears that the spread of the data may support the initial hypotheses that I made but I will have to complete the full data analysis to determine whether there is a level of significance within the data to support those hypotheses. 


Good thorough exploration. See my various comments above.
Now that I have completed the data exploration phase and cleaning the data, I will save the processed data as a new .csv file to use for analysis.

```{r}
# save the processed data
write.csv(DF_refined, here("Data", "Processed", "processed_prosthetic_analysis.csv"), row.names = FALSE)
```



